#book #deepdive #javascript

# 13장 스코프

### 스코프(scope)란?

> 식별자가 유효한 범위

모든 식별자(변수 이름, 함수이름, 클래스 이름등)는 자신이 `선언된 위치`에 의해 다른 코드가 식별자 자신을 참조할 수 있는 유효 범위가 결정된다.

JS엔진은 스코프를 통해 어떤 변수를 참조해야 할지 결정하는데 이를 `식별자 결정(identifier resolution)`이라고 한다. 따라서 스코프란 JS엔진 식별자를 검색할때 사용하는 규칙이라 할 수 있다.

JS엔진은 코드를 실행할때 코드의 문맥 (context)를 고려한다.
코드의 문맥은 렉시컬환경 (Lexical environment)으로 이뤄지면 이걸 구현한것이 `실행 컨텍스트(execution context)` 모든 코드는 실행 컨텍스트에서 평가되고 실행된다.

<br>

### 스코프의 종류

- `전역 스코프(global scope):` 전역적으로 유효한 범위. 전역 변수는 어디서든 참조 가능.
- `지역 스코프 (local scope)`: 본인 코드블럭 몸체 내 (하위 스코프 포함)에서 유효한 범위. 지역범수는 그 안에서만 유효
  - 함수 스코프(function scope): 함수 내부에서만 유효
  - 블록 레벨 스코프 (block scope): {}안에서만 유효한 범위 (if, while, for, try/catch 등)

<br>

### 스코프 체인

스코프 체인은 계층적 구조를 가진다.
제일 내부에서 부터 외부로 `단방향` 스코프 체인이 일어난다.
JS엔진은 이 스코프 체인을 참고해 식별자를 검색하는데 여기서 `단방향`으로 이뤄지기 떄문에
하위 스코프에서는 상위 스코프의 변수를 참조가능 하지만 상위에서는 하위 스코프 내 변수를 참조하지 못한다.

이 스코프 체인은 물리적으로 존재, JS는 렉시컬 환경을 실제로 생성한다.
렉시컬 환경은 아래 그림처럼 그 상위 스코프(또 다른 렉시컬 환경)의 참조를 외부환경 참조 (Outer Lexical Environment Reference)에 기록한다.
이런식으로 체이닝을 해 위치를 기억할 수 있음.

![Screenshot 2025-01-21 at 12 35 00 PM](https://github.com/user-attachments/assets/93978f0f-d79b-4250-b35f-2258d0bdf36a)

<br>

### 함수레벨 스코프

코드 블록이 아닌 함수에 의해서만 생긴 지역 스코프

`var` 키워드로 선언된 변수는 오로지 `함수 레벨 스코프`만을 지역 스코프로 인정한다.
다시말해 다른 {} 블록 레벨에서 정의된 var는 전역변수나 다름없는 것이다.

<br>

### 렉시컬 스코프

상위 스코프를 정의하는 방식 2가지

1. `동적 스코프(dynamic scope):` 함수를 `호출한 위치`에 따라 함수의 상위 스코프 결정.
2. `렉시컬 스코프 (lexical scope):` 또는 정적 스코프(static scope)는 함수를 `정의한 위치`에 따라 상위 스코프를 결정.

자바스크립트는 렉시컬 스코프를 따르므로 함수가 정의된 위치 기반으로 상위 스코프를 결정한다.
렉시컬 스코프이기 때문에 계층적인 구조를 가질 수 밖에 없음.